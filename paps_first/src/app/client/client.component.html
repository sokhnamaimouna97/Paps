<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center">
          <h1 class="text-2xl font-bold text-indigo-600">
            {{ currentBoutique ? currentBoutique.nom_boutique : 'Paps Boutique' }}
          </h1>
        </div>

        <div class="flex items-center space-x-4">
          <!-- Panier -->
          <button
            *ngIf="currentBoutique"
            (click)="navigateTo('cart')"
            class="relative p-2 text-gray-400 hover:text-gray-500"
          >
            🛒 <span *ngIf="cart.length > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
              {{ getCartItemCount() }}
            </span>
          </button>

          <!-- Boutique -->
          <button
            *ngIf="currentBoutique && currentView !== 'boutique'"
            (click)="backToBoutique()"
            class="text-gray-400 hover:text-gray-500"
          >
            🏪 Retour à la boutique
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">

    <!-- Loading -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
      <span class="ml-3 text-gray-600">Chargement...</span>
    </div>

    <!-- Welcome View -->
    <div *ngIf="currentView === 'welcome' && !isLoading" class="px-4 py-6 sm:px-0">
      <div class="max-w-2xl mx-auto text-center">
        <div class="mb-8">
          <h1 class="text-4xl font-bold text-gray-900 mb-4">🛍️ Bienvenue sur Paps</h1>
          <p class="text-xl text-gray-600 mb-8">
            Accédez à votre boutique personnalisée via le lien d'invitation fourni par votre commerçant.
          </p>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-8">
          <div class="mb-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">🔗 Accès par invitation</h2>
            <p class="text-gray-600 mb-6">
              Pour accéder à une boutique, vous devez utiliser le lien d'invitation que votre commerçant vous a envoyé.
            </p>
          </div>

          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <h3 class="text-sm font-medium text-blue-800 mb-2">💡 Comment ça marche ?</h3>
            <ul class="text-sm text-blue-700 space-y-2 text-left">
              <li>• Le commerçant vous envoie un lien d'invitation</li>
              <li>• Cliquez sur le lien pour accéder à sa boutique</li>
              <li>• Parcourez les produits et ajoutez-les à votre panier</li>
              <li>• Remplissez le formulaire de commande</li>
              <li>• Recevez une confirmation par email</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Boutique View -->
    <div *ngIf="currentView === 'boutique' && currentBoutique && !isLoading" class="px-4 py-6 sm:px-0">
      <!-- Informations de la boutique -->
      <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">{{ currentBoutique.nom_boutique }}</h2>
            <p *ngIf="currentBoutique.description" class="text-gray-600 mt-2">{{ currentBoutique.description }}</p>
            <div class="flex items-center space-x-6 mt-4 text-sm text-gray-500">
              <span *ngIf="currentBoutique.adresse">📍 {{ currentBoutique.adresse }}</span>
              <span *ngIf="currentBoutique.telephone">📞 {{ currentBoutique.telephone }}</span>
              <span *ngIf="currentBoutique.email">📧 {{ currentBoutique.email }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtres et recherche -->
      <div class="bg-white rounded-lg shadow-sm p-4 mb-6">
        <div class="flex flex-col sm:flex-row gap-4">
          <div class="flex-1">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="searchProducts()"
              placeholder="🔍 Rechercher un produit..."
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
          </div>
          <div class="sm:w-48">
            <select
              [(ngModel)]="selectedCategory"
              (change)="filterByCategory()"
              class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
              <option value="">Toutes les catégories</option>
              <option *ngFor="let category of categories" [value]="category._id">
                {{ category.nom }}
              </option>
            </select>
          </div>
        </div>
      </div>

      <!-- Grille des produits -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <div *ngFor="let product of products" class="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow">
          <div class="aspect-w-1 aspect-h-1 bg-gray-200">
            <img
              *ngIf="product.image"
              [src]="product.image"
              [alt]="product.nom"
              class="w-full h-48 object-cover"
            >
            <div *ngIf="!product.image" class="w-full h-48 bg-gray-200 flex items-center justify-center">
              <span class="text-gray-400">📦</span>
            </div>
          </div>

          <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ product.nom }}</h3>
            <p class="text-2xl font-bold text-indigo-600 mb-2">{{ product.prix }} €</p>
            <p class="text-sm text-gray-500 mb-4">
              Stock: {{ product.stock }} disponible{{ product.stock > 1 ? 's' : '' }}
            </p>

            <button
              (click)="addToCart(product)"
              [disabled]="product.stock === 0"
              class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors"
            >
              {{ product.stock === 0 ? 'Rupture de stock' : '🛒 Ajouter au panier' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Message si aucun produit -->
      <div *ngIf="products.length === 0" class="text-center py-12">
        <div class="text-gray-400 text-6xl mb-4">📦</div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Aucun produit trouvé</h3>
        <p class="text-gray-600">Aucun produit ne correspond à votre recherche.</p>
      </div>
    </div>

    <!-- Cart View -->
    <div *ngIf="currentView === 'cart' && !isLoading" class="px-4 py-6 sm:px-0">
      <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-sm">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900">🛒 Votre panier</h2>
          </div>

          <div class="p-6">
            <div *ngIf="cart.length === 0" class="text-center py-12">
              <div class="text-gray-400 text-6xl mb-4">🛒</div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">Votre panier est vide</h3>
              <p class="text-gray-600 mb-6">Ajoutez des produits pour commencer vos achats.</p>
              <button
                (click)="backToBoutique()"
                class="bg-indigo-600 text-white py-2 px-6 rounded-md hover:bg-indigo-700"
              >
                Retour à la boutique
              </button>
            </div>

            <div *ngIf="cart.length > 0">
              <!-- Liste des produits -->
              <div class="space-y-4 mb-6">
                <div *ngFor="let item of cart" class="flex items-center space-x-4 p-4 border border-gray-200 rounded-lg">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900">{{ item.product.nom }}</h3>
                    <p class="text-gray-600">{{ item.product.prix }} €</p>
                  </div>

                  <div class="flex items-center space-x-2">
                    <button
                      (click)="updateQuantity(item.product._id, item.quantity - 1)"
                      class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300"
                    >
                      -
                    </button>
                    <span class="w-12 text-center">{{ item.quantity }}</span>
                    <button
                      (click)="updateQuantity(item.product._id, item.quantity + 1)"
                      [disabled]="item.quantity >= item.product.stock"
                      class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center hover:bg-gray-300 disabled:opacity-50"
                    >
                      +
                    </button>
                  </div>

                  <div class="text-right">
                    <p class="font-semibold">{{ item.product.prix * item.quantity }} €</p>
                    <button
                      (click)="removeFromCart(item.product._id)"
                      class="text-red-500 hover:text-red-700 text-sm"
                    >
                      Supprimer
                    </button>
                  </div>
                </div>
              </div>

              <!-- Total -->
              <div class="border-t border-gray-200 pt-4">
                <div class="flex justify-between items-center">
                  <span class="text-lg font-semibold">Total:</span>
                  <span class="text-2xl font-bold text-indigo-600">{{ getCartTotal() }} €</span>
                </div>
              </div>

              <!-- Actions -->
              <div class="flex justify-between items-center mt-6">
                <button
                  (click)="backToBoutique()"
                  class="bg-gray-200 text-gray-700 py-2 px-6 rounded-md hover:bg-gray-300"
                >
                  ← Continuer les achats
                </button>
                <button
                  (click)="navigateTo('checkout')"
                  class="bg-indigo-600 text-white py-2 px-8 rounded-md hover:bg-indigo-700"
                >
                  Passer la commande →
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout View -->
    <div *ngIf="currentView === 'checkout' && !isLoading" class="px-4 py-6 sm:px-0">
      <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-lg shadow-sm">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900">💳 Finaliser votre commande</h2>
          </div>

          <div class="p-6">
            <!-- Résumé de la commande -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
              <h3 class="font-semibold text-gray-900 mb-3">📋 Résumé de votre commande</h3>
              <div class="space-y-2">
                <div *ngFor="let item of cart" class="flex justify-between">
                  <span>{{ item.product.nom }} x{{ item.quantity }}</span>
                  <span>{{ item.product.prix * item.quantity }} €</span>
                </div>
                <div class="border-t pt-2 flex justify-between font-semibold">
                  <span>Total:</span>
                  <span>{{ getCartTotal() }} €</span>
                </div>
              </div>
            </div>

            <!-- Formulaire de commande -->
            <form [formGroup]="checkoutForm" (ngSubmit)="placeOrder()" class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">👤 Prénom *</label>
                  <input
                    type="text"
                    formControlName="prenom"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  >
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">👤 Nom *</label>
                  <input
                    type="text"
                    formControlName="nom"
                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  >
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">📞 Téléphone *</label>
                <input
                  type="tel"
                  formControlName="telephone"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">📧 Email *</label>
                <input
                  type="email"
                  formControlName="email"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">🏠 Adresse de livraison *</label>
                <textarea
                  formControlName="adresse"
                  rows="3"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                ></textarea>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700">💬 Message (optionnel)</label>
                <textarea
                  formControlName="message"
                  rows="3"
                  placeholder="Instructions spéciales, commentaires..."
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                ></textarea>
              </div>

              <!-- Actions -->
              <div class="flex justify-between items-center pt-4">
                <button
                  type="button"
                  (click)="navigateTo('cart')"
                  class="bg-gray-200 text-gray-700 py-2 px-6 rounded-md hover:bg-gray-300"
                >
                  ← Retour au panier
                </button>
                <button
                  type="submit"
                  [disabled]="checkoutForm.invalid || isLoading"
                  class="bg-indigo-600 text-white py-2 px-8 rounded-md hover:bg-indigo-700 disabled:opacity-50"
                >
                  {{ isLoading ? '⏳ Traitement...' : '✅ Confirmer la commande' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
